<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Tracking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
    --primary-color: #4a6bff;
    --secondary-color: #f8f9fa;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --warning-color: #ffc107;
    --info-color: #17a2b8;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --border-radius: 8px;
    --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Roboto', sans-serif;
    background-color: #f5f7fa;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, var(--primary-color), #6c5ce7);
    color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    animation: fadeIn 0.5s ease-in-out;
}

.header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

.main-content {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
}

.form-section, .table-section {
    flex: 1;
    min-width: 300px;
    background: white;
    padding: 25px;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    animation: slideUp 0.5s ease-in-out;
}

.form-section {
    max-width: 400px;
}

h2 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #555;
}

input, select, textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
}

textarea {
    resize: vertical;
    min-height: 80px;
}

.btn {
    display: inline-block;
    padding: 12px 24px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn:hover {
    background-color: #3a5bef;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background-color: var(--primary-color);
}

.btn-danger {
    background-color: var(--danger-color);
}

.btn-success {
    background-color: var(--success-color);
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.search-box {
    position: relative;
    width: 250px;
}

.search-box input {
    padding-left: 40px;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #777;
}

.table-responsive {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background-color: var(--primary-color);
    color: white;
    font-weight: 500;
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

tr:hover {
    background-color: #f1f1f1;
}

.status {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
}

.status-not-replied {
    background-color: #ffebee;
    color: var(--danger-color);
}

.status-replied {
    background-color: #e8f5e9;
    color: var(--success-color);
}

.action-buttons {
    display: flex;
    gap: 8px;
}

.action-btn {
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    color: white;
    font-size: 0.9rem;
}

.action-btn:hover {
    transform: scale(1.1);
}

.notification-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease-in-out;
}

.modal-content {
    background-color: white;
    padding: 30px;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 500px;
    position: relative;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.close-modal {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 1.5rem;
    cursor: pointer;
    color: #777;
    transition: var(--transition);
}

.close-modal:hover {
    color: var(--danger-color);
}

.telegram-form {
    margin-top: 20px;
}

.telegram-form .form-group {
    margin-bottom: 15px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 768px) {
    .main-content {
        flex-direction: column;
    }
    
    .form-section, .table-section {
        max-width: 100%;
    }
    
    .table-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .search-box {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-store"></i> SHOP TRACKING SYSTEM</h1>
            <p>Theo dõi trạng thái phản hồi từ các shop</p>
        </header>

        <div class="main-content">
            <div class="form-section">
                <h2><i class="fas fa-plus-circle"></i> Thêm Shop Mới</h2>
                <form id="shopForm">
                    <div class="form-group">
                        <label for="shopName">Tên Shop:</label>
                        <input type="text" id="shopName" required placeholder="Nhập tên shop...">
                    </div>
                    <div class="form-group">
                        <label for="shopLink">Link Shop:</label>
                        <input type="url" id="shopLink" required placeholder="Nhập link shop...">
                    </div>
                    <div class="form-group">
                        <label for="status">Trạng thái:</label>
                        <select id="status">
                            <option value="not_replied">Chưa rep</option>
                            <option value="replied">Đã rep</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notes">Ghi chú (không bắt buộc):</label>
                        <textarea id="notes" rows="2" placeholder="Nhập ghi chú nếu có..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Lưu Thông Tin
                    </button>
                </form>
            </div>

            <div class="table-section">
                <div class="table-header">
                    <h2><i class="fas fa-list"></i> Danh Sách Shop</h2>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Tìm kiếm shop...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="shopTable">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Thời Gian</th>
                                <th>Tên Shop</th>
                                <th>Link Shop</th>
                                <th>Trạng Thái</th>
                                <th>Ghi Chú</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="shopTableBody">
                            <!-- Dữ liệu sẽ được thêm động bằng JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="notification-modal" id="notificationModal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3><i class="fas fa-bell"></i> Thông Báo Telegram</h3>
                <p>Bạn có muốn thiết lập thông báo Telegram cho các shop chưa phản hồi sau 7 ngày không?</p>
                <div class="telegram-form">
                    <label for="botToken">Bot Token:</label>
                    <input type="text" id="botToken" placeholder="Nhập Telegram Bot Token">
                    <label for="chatId">Chat ID:</label>
                    <input type="text" id="chatId" placeholder="Nhập Chat ID">
                    <button id="saveTelegramConfig" class="btn btn-primary">Lưu Cấu Hình</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // Khởi tạo dữ liệu từ localStorage hoặc tạo mới nếu chưa có
    let shops = JSON.parse(localStorage.getItem('shops')) || [];
    let telegramConfig = JSON.parse(localStorage.getItem('telegramConfig')) || null;
    
    // DOM Elements
    const shopForm = document.getElementById('shopForm');
    const shopTableBody = document.getElementById('shopTableBody');
    const searchInput = document.getElementById('searchInput');
    const notificationModal = document.getElementById('notificationModal');
    const closeModal = document.querySelector('.close-modal');
    const saveTelegramConfigBtn = document.getElementById('saveTelegramConfig');
    
    // Hiển thị dữ liệu ban đầu
    renderShopTable(shops);
    
    // Xử lý form thêm shop mới
    shopForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const shopName = document.getElementById('shopName').value;
        const shopLink = document.getElementById('shopLink').value;
        const status = document.getElementById('status').value;
        const notes = document.getElementById('notes').value;
        
        const newShop = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            shopName,
            shopLink,
            status,
            notes,
            notified: false
        };
        
        shops.unshift(newShop);
        saveToLocalStorage();
        renderShopTable(shops);
        
        // Reset form
        shopForm.reset();
        
        // Hiển thị animation khi thêm thành công
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-check"></i> Đã Lưu';
        submitBtn.style.backgroundColor = 'var(--success-color)';
        
        setTimeout(() => {
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Lưu Thông Tin';
            submitBtn.style.backgroundColor = 'var(--primary-color)';
        }, 2000);
        
        // Kiểm tra và hiển thị modal cấu hình Telegram nếu chưa có
        if (!telegramConfig) {
            setTimeout(() => {
                notificationModal.style.display = 'flex';
            }, 1000);
        }
    });
    
    // Xử lý tìm kiếm
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredShops = shops.filter(shop => 
            shop.shopName.toLowerCase().includes(searchTerm) || 
            shop.notes.toLowerCase().includes(searchTerm)
        );
        renderShopTable(filteredShops);
    });
    
    // Xử lý thay đổi trạng thái
    function handleStatusChange(shopId, newStatus) {
        shops = shops.map(shop => 
            shop.id === shopId ? { ...shop, status: newStatus } : shop
        );
        saveToLocalStorage();
        renderShopTable(shops);
    }
    
    // Xử lý xóa shop
    function handleDeleteShop(shopId) {
        if (confirm('Bạn có chắc chắn muốn xóa shop này không?')) {
            shops = shops.filter(shop => shop.id !== shopId);
            saveToLocalStorage();
            renderShopTable(shops);
        }
    }
    
    // Lưu cấu hình Telegram
    saveTelegramConfigBtn.addEventListener('click', function() {
        const botToken = document.getElementById('botToken').value;
        const chatId = document.getElementById('chatId').value;
        
        if (botToken && chatId) {
            telegramConfig = { botToken, chatId };
            localStorage.setItem('telegramConfig', JSON.stringify(telegramConfig));
            notificationModal.style.display = 'none';
            
            // Hiển thị thông báo thành công
            alert('Cấu hình Telegram đã được lưu thành công!');
        } else {
            alert('Vui lòng nhập đầy đủ Bot Token và Chat ID');
        }
    });
    
    // Đóng modal
    closeModal.addEventListener('click', function() {
        notificationModal.style.display = 'none';
    });
    
    // Kiểm tra thông báo hàng ngày
    function checkForNotifications() {
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        
        const shopsToNotify = shops.filter(shop => {
            const shopDate = new Date(shop.timestamp);
            return (
                shop.status === 'not_replied' && 
                !shop.notified && 
                shopDate <= sevenDaysAgo
            );
        });
        
        if (shopsToNotify.length > 0 && telegramConfig) {
            sendTelegramNotification(shopsToNotify);
            
            // Đánh dấu đã thông báo
            shops = shops.map(shop => {
                if (shopsToNotify.some(s => s.id === shop.id)) {
                    return { ...shop, notified: true };
                }
                return shop;
            });
            
            saveToLocalStorage();
        }
    }
    
    // Gửi thông báo Telegram (mô phỏng)
    function sendTelegramNotification(shopsToNotify) {
        console.log('Gửi thông báo Telegram cho các shop sau:');
        shopsToNotify.forEach(shop => {
            console.log(`- ${shop.shopName} (${shop.shopLink}) đã 7 ngày chưa phản hồi`);
            
            // Trong thực tế, bạn sẽ gọi API Telegram ở đây
            // fetch(`https://api.telegram.org/bot${telegramConfig.botToken}/sendMessage`, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({
            //         chat_id: telegramConfig.chatId,
            //         text: `Shop ${shop.shopName} (${shop.shopLink}) đã 7 ngày chưa phản hồi!`
            //     })
            // });
        });
        
        // Hiển thị thông báo trên giao diện
        showAlertNotification(shopsToNotify.length);
    }
    
    // Hiển thị thông báo trên giao diện
    function showAlertNotification(count) {
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert-notification';
        alertDiv.innerHTML = `
            <i class="fas fa-bell"></i>
            <span>Đã gửi ${count} thông báo Telegram cho các shop chưa phản hồi sau 7 ngày</span>
            <i class="fas fa-times close-alert"></i>
        `;
        
        document.body.appendChild(alertDiv);
        
        // Tự động ẩn sau 5 giây
        setTimeout(() => {
            alertDiv.classList.add('hide');
            setTimeout(() => alertDiv.remove(), 300);
        }, 5000);
        
        // Xử lý đóng thủ công
        alertDiv.querySelector('.close-alert').addEventListener('click', () => {
            alertDiv.classList.add('hide');
            setTimeout(() => alertDiv.remove(), 300);
        });
    }
    
    // Render bảng dữ liệu
    function renderShopTable(shopsToRender) {
        shopTableBody.innerHTML = '';
        
        if (shopsToRender.length === 0) {
            shopTableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="no-data">
                        <i class="fas fa-info-circle"></i> Không có dữ liệu shop nào
                    </td>
                </tr>
            `;
            return;
        }
        
        shopsToRender.forEach((shop, index) => {
            const row = document.createElement('tr');
            const shopDate = new Date(shop.timestamp);
            const formattedDate = shopDate.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const daysDiff = Math.floor((new Date() - shopDate) / (1000 * 60 * 60 * 24));
            const daysInfo = daysDiff > 0 ? ` (${daysDiff} ngày trước)` : '';
            
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${formattedDate}${daysInfo}</td>
                <td>${shop.shopName}</td>
                <td><a href="${shop.shopLink}" target="_blank" class="shop-link">Xem shop</a></td>
                <td>
                    <select class="status-select" data-id="${shop.id}">
                        <option value="not_replied" ${shop.status === 'not_replied' ? 'selected' : ''}>Chưa rep</option>
                        <option value="replied" ${shop.status === 'replied' ? 'selected' : ''}>Đã rep</option>
                    </select>
                </td>
                <td>${shop.notes || '-'}</td>
                <td>
                    <button class="action-btn btn-danger" onclick="handleDeleteShop(${shop.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            shopTableBody.appendChild(row);
        });
        
        // Thêm event listeners cho các select
        document.querySelectorAll('.status-select').forEach(select => {
            select.addEventListener('change', function() {
                handleStatusChange(parseInt(this.dataset.id), this.value);
            });
        });
    }
    
    // Lưu dữ liệu vào localStorage
    function saveToLocalStorage() {
        localStorage.setItem('shops', JSON.stringify(shops));
    }
    
    // Kiểm tra thông báo mỗi khi trang được tải
    checkForNotifications();
    
    // Kiểm tra thông báo mỗi ngày (mô phỏng)
    setInterval(checkForNotifications, 24 * 60 * 60 * 1000); // 24 giờ
    
    // Expose functions to global scope for inline event handlers
    window.handleDeleteShop = handleDeleteShop;
});

// Thêm CSS động cho alert notification
const style = document.createElement('style');
style.textContent = `
.alert-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--primary-color);
    color: white;
    padding: 15px 20px;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
    transition: var(--transition);
}

.alert-notification.hide {
    animation: slideOut 0.3s ease-in;
    opacity: 0;
}

.alert-notification .close-alert {
    cursor: pointer;
    margin-left: 10px;
}

@keyframes slideIn {
    from { 
        transform: translateX(100%);
        opacity: 0;
    }
    to { 
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from { 
        transform: translateX(0);
        opacity: 1;
    }
    to { 
        transform: translateX(100%);
        opacity: 0;
    }
}

.shop-link {
    color: var(--primary-color);
    text-decoration: none;
    transition: var(--transition);
}

.shop-link:hover {
    text-decoration: underline;
    color: #3a5bef;
}

.no-data {
    text-align: center;
    padding: 20px;
    color: #777;
}

.no-data i {
    margin-right: 8px;
}
`;
document.head.appendChild(style);
    </script>
</body>
</html>
